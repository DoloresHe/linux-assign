# 铁路售票系统设计文档

简单的模拟铁路售票系统：

1. 单机C/S系统；
2. 网络C/S系统或B/S系统。

## 程序功能界定

### 1. 注册

1. 用户输入必要的注册信息：用户名（即邮箱），密码，姓名，联系电话等信息进行注册。
2. 用户名必须唯一，若用户名已经存在则提示用户，并要求其更改用户名再注册。
3. 密码需输入两次，若两次不密码不相同则提示用户重新输入密码。
4. 注册完成后系统返回注册成功信息。 

### 2. 登陆

1. 用户凭用户名和密码对在系统进行登陆。
2. 用户名和密码都不能为空，如不符合规范，则提示用户补完输入。
3. 登陆成功，则进入系统，反之提示用户名或密码错误并回到第1步。

### 3. 车票查询

1. 用户登陆后，系统给出欢迎提示，并列出简要的操作指南。
2. 用户按照车票日期，时刻，始发站和目的地中的一个或几个条件的组合查询车票。
3. 系统查询车票，若存在则返回所有结果，若不存在则给出不存在的提示。
4. 用户重复2、3步骤若干次直至选中车票进入订票步骤或直接退出。

### 4. 预订车票

1. 用户选中车票后选择预订。
2. 用户填写预订车票的数量。
3. 用户提交订单。
4. 系统处理订单，返回预订结果。
5. 用户退出订票系统或继续进行购票。

### 5. 系统需求

1. 对服务器所有的动作都需要记录在log文件中。它们包括：

    * 所有客户端和服务器的连接记录；
    * 用户的查询请求；
    * 用户的创建；
    * 用户的订票请求；
    * 程序运行中出现的警告，错误。

2. 性能：至少可以同时为100个用户服务；单次请求响应时间，单机版本至多为0.5秒，网络版至多为1.0秒。

3. 系统可水平拓展。

## 人机交互设计

简易模拟铁路售票系统在交互上使用CLI，以会话形式进行交互。通用命令格式为:

    command [options...] [expression]

表达式格式为: `-predicate vaule`

按照功能界定，提供的命令有:

    login   登陆;
    logout  登出;
    query   查询;
    book    订票;
    help    帮助;


## 概要设计 

单机版和网络版的铁路售票系统中，客户端和服务器的通信都以socket为基础。考虑到铁路购票系统需要同时为多个用户服务，有两种思路：

1. 用一个队列把购票者排起来，逐个进行处理；
2. 服务器使用多线程或多进程来同时处理多个请求。

队列形式实现起来相对简单，所有业务都是同步的，不需要在库存管理上多做设计，且几乎不存在进程间通信问题。坏处是一旦用户多起来，平均等待时间将会增加。即使每个用户只用10秒就能订好票，对队列位置靠后的用户来说等待时间也会很长，如第60位用户需要等上10分钟。

第二种设计在用户订票体验和系统效率上很占优势。本模拟铁路购票程序采用第二中设计。当然在设计上需要做更多考量。

简要原理：

服务器监听端口，


### 1. 单机C/S版

### 2. 网络C/S版




