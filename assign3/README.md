# 简易find命令实现

## 简介

find——用于在目录中搜索文件。  

## 编译安装

目录下已经有Makefile，`make` 即可。如需要DEBUG版本，则 `make DEBUG=1`。  
如要清除目标文件和程序 `make clean` 。

## 基本格式

    ./myfind [path...] [expression...]

## 功能特性

本程序可以帮助你在目录中找到具有一下特征的文件:

* 文件名中含有特定文字或者匹配一定的表达式；
* 文件的权限；
* 文件类型；
* 文件的uid和gid；
* 在最近有所使用；（未完成，time函数无法通过本人机器上的gcc编译，因此代码注释了）
* 在某一个大小范围；（未完成）
* 或者具有以上条件的组合（目前仅为AND）的文件；

当找到所要寻找的文件以后，程序将打印文件具体路径。

## 具体用法
    ./myfind [path...] [expression...]
    目录非必须，若未输入，则默认为` . `（即当前目录）。
    用户可以输入多个文件目录以供查找。若目录或文件无法访问程序会报错。
	-name 
    按照文件名查找文件。
    -perm 
    按照文件权限来查找文件。
    -uid
    按照文件属主来查找文件。
    -gid
    按照文件所属的组来查找文件。
    -mtime n
    按照文件的更改时间来查找文件。（未完成）
	-atime n
    按照文件的访问时间来查找文件。（未完成）
	-ctime n 
    按照文件的创建时间来查找文件。（未完成）
    -type 
    查找某一类型的文件，诸如：
    b - 块设备文件。
    d - 目录。
    c - 字符设备文件。
    p - 管道文件。
    l - 符号链接文件。
    f - 普通文件。
    -mindepth：在查找文件时，首先查找当前目录中的文件，然后再在其子目录中查找。（未完成）

## 应用举例

### 在目录下按单个条件查找

    ./myfind . -name test
	./myfind -name test
	./myfind ~/ -uid 1000
	./myfind ~/ -gid 1000
	./myfind ~/ -perm 664

### 在多个文件目录下按文件名查找

    ./myfind ~/ /etc /var -name test
	
### 多个表达式组合查找

    ./myfind /home -name test1 -type f -perm 664
	
## 程序设计

程序主要由以下几个部分组成：

    find.c    主文件。包含目录文件的遍历，对解释器的API调用等。
	parser.c  解释器，负责将用户输入转化成predicate结构。
	pred.c    具体的条件检测工具——即过滤器。维护了一个判断结构的链表。
	defs.h    结构定义个共享函数声明。

程序整体思路：
	
	1. 从命令行读取用户输入。将 `-` 前的字符串处理为 `path` ，并存入链表。
	2. 有parser逐个对命令选项和参数进行解析。此处运用了 *表驱动编程* ，读取选项
	字符串后在parser_table里查找，将predicate函数指针和参数绑定，存入链表。
	3. 解释完命令后，程序对逐个在用户输入的目录里，利用过滤器检测，并遍历目标目录。
	4. 通过过滤器的文件的路径将被打印。
	
关键技术：

* 表驱动编程，避免了繁琐的条件判断。减少代码量。变相实现面向对象和多态。
* 链表的使用。

## 灵活性和可拓展性

为程序添加新功能点很容易：

1. 添加 `pred_xxx()`函数；
2. 添加 `parser_xxx()`函数;
3. 更新 `parser_table` ;

是的，就是如此简单。

091250146  唐毅明

本学期的Linux作业都会在github托管，并且会保持更新。 
最新版本的代码：https://github.com/krafttuc/linux-assign




